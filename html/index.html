<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± ESP-12E ESP8266 - –°—Ç–∞—Ç—É—Å</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 7px;
            margin: 7px;
            background: #f5f5f5
        }
        .container {
            max-width: 650px;
            background: white;
            padding: 14px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin: 0 auto;
        }
        .panel {
            background: #e8f4fd;
            padding: 14px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        .btn-nav {
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            gap: 7px;
        }
        .btn-nav a {
            display: inline-block;
            padding: 8px 16px;
            background: #1a73e8;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        h2 {
            color: #1a73e8;
            text-align: center;
            margin: 0;
            font-size: 1.4rem;
        }
        .panel-title {
            margin: 0;
            padding-bottom: 7px;
            border-bottom: 1px solid #d0e8fc;
        }
        .panel-row {
            display: flex;
            font-size: 0.9rem;
        }
        .panel-row > *{
            width: 100%;
            vertical-align: text-bottom;
        }
        .panel-row > .panel-value:nth-child(3) {
            color: #666; 
            font-style: italic; 
            text-align: right;
        }
        .panel-label {
            font-weight: bold;
            color: #5f6368;
            padding-right: 8px;
        }
        .panel-value {
            color: #202124;
        }
    </style>
</head>
<body>
    <div class='container'>

        <div class="panel">
            <div class="btn-nav">
                <a href="/">–°—Ç–∞—É—Å</a>
                <a href="/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                <a href="/sensors">–î–∞—Ç—á–∏–∫–∏</a>
                <a href="/attributes">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</a>
            </div>
        </div>
<h2>üå°Ô∏è –î–∞–Ω–Ω—ã–µ –º–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü–∏–∏</h2>

        <div class='panel'>
            <div class="sensor-large">
                <div class="sensor-value" id="temperature">--.-</div>
                <div class="sensor-unit">¬∞C</div>
            </div>
            <div class="sensor-large">
                <div class="sensor-value" id="humidity">--</div>
                <div class="sensor-unit">%</div>
            </div>
            <div class="sensor-large">
                <div class="sensor-value" id="pressure">---</div>
                <div class="sensor-unit">–º–º —Ä—Ç.—Å—Ç.</div>
            </div>
        </div>

        <div class='panel'>
            <h3 class="panel-title">–°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class='data-row'>
                <span class='data-label'>–°–≤–æ–±–æ–¥–Ω–∞—è RAM:</span>
                <span class='data-value' id="freeHeap">-- KB</span>
            </div>
            <div class='data-row'>
                <span class='data-label'>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</span>
                <span class='data-value' id="uptime">-- —á -- –º–∏–Ω</span>
            </div>
            <div class='data-row'>
                <span class='data-label'>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:</span>
                <span class='data-value' id="connectedDevices">--</span>
            </div>
            <div class='data-row'>
                <span class='data-label'>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:</span>
                <span class='data-value' id="memoryUsage">--%</span>
            </div>
            <div id="memoryBar" class="memory-bar">
                <div class="memory-fill" style="width: 0%"></div>
            </div>
        </div>

        <div class='panel'>
            <h3 class="panel-title">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
            <div class='data-row'>
                <span class='data-label'>Wi-Fi —Å—Ç–∞—Ç—É—Å:</span>
                <span class='data-value'><span class="status-indicator status-online" id="wifiStatus"></span><span id="wifiStatusText">–û–Ω–ª–∞–π–Ω</span></span>
            </div>
            <div class='data-row'>
                <span class='data-label'>IP –∞–¥—Ä–µ—Å:</span>
                <span class='data-value' id="ipAddress">192.168.4.1</span>
            </div>
        </div>

        <div class="last-update" id="lastUpdate">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: --
        </div>

        <button class="refresh-btn" onclick="updateData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

        <script>
            // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
            function formatUptime(seconds) {
                const days = Math.floor(seconds / 86400);
                const hours = Math.floor((seconds % 86400) / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                
                if (days > 0) {
                    return `${days} –¥–Ω ${hours} —á ${minutes} –º–∏–Ω`;
                } else if (hours > 0) {
                    return `${hours} —á ${minutes} –º–∏–Ω`;
                } else {
                    return `${minutes} –º–∏–Ω`;
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            function updateData() {
                fetch('/api/status')
                    .then(response => response.json())
                    .then(data => {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã–µ
                        document.getElementById('temperature').textContent = data.temperature.toFixed(1);
                        document.getElementById('humidity').textContent = data.humidity;
                        document.getElementById('pressure').textContent = data.pressure;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                        document.getElementById('freeHeap').textContent = (data.freeHeap / 1024).toFixed(1) + ' KB';
                        document.getElementById('uptime').textContent = formatUptime(data.uptime);
                        document.getElementById('connectedDevices').textContent = data.connectedDevices;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
                        const memoryUsage = ((data.totalHeap - data.freeHeap) / data.totalHeap * 100).toFixed(1);
                        document.getElementById('memoryUsage').textContent = memoryUsage + '%';
                        document.querySelector('.memory-fill').style.width = memoryUsage + '%';
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å Wi-Fi
                        const wifiOnline = data.wifiConnected;
                        const wifiIndicator = document.getElementById('wifiStatus');
                        const wifiText = document.getElementById('wifiStatusText');
                        
                        if (wifiOnline) {
                            wifiIndicator.className = 'status-indicator status-online';
                            wifiText.textContent = '–û–Ω–ª–∞–π–Ω';
                        } else {
                            wifiIndicator.className = 'status-indicator status-offline';
                            wifiText.textContent = '–û—Ñ—Ñ–ª–∞–π–Ω';
                        }
                        
                        document.getElementById('ipAddress').textContent = data.ipAddress;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                        const now = new Date();
                        document.getElementById('lastUpdate').textContent = 
                            `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${now.toLocaleTimeString()}`;
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ü–∏—é –æ—à–∏–±–∫–∏
                    });
            }

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(updateData, 2000);

            // –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.addEventListener('DOMContentLoaded', function() {
                updateData();
            });
        </script>
    </div>
    </div>
</body>
</html>