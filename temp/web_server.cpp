// –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã
#include "web_server.h"        // –ù–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª
#include "web_pages.h"         // HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PROGMEM)
#include <ESP8266WiFi.h>       // –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Wi-Fi –¥–ª—è ESP8266
#include <LittleFS.h>          // –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

// –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 80 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π HTTP)
ESP8266WebServer server(80);

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JSON-—Å—Ç—Ä–æ–∫—É —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–∞—Ç—á–∏–∫–æ–≤
 * –í –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –¥–∞—Ç—á–∏–∫–æ–≤
 * @return String JSON-—Å—Ç—Ä–æ–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–∞—Ç—á–∏–∫–æ–≤
 */
String getSensorDataJSON() {
  // –§–æ—Ä–º–∏—Ä—É–µ–º JSON-–æ–±—ä–µ–∫—Ç —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
  // temperature: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö –¶–µ–ª—å—Å–∏—è
  // humidity: –≤–ª–∞–∂–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö  
  // pressure: –¥–∞–≤–ª–µ–Ω–∏–µ –≤ –º–º —Ä—Ç—É—Ç–Ω–æ–≥–æ —Å—Ç–æ–ª–±–∞
  String json = "{\"temperature\":22.5,\"humidity\":45,\"pressure\":755}";
  return json;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ MAC-–∞–¥—Ä–µ—Å–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫ —Ç–æ—á–∫–µ –¥–æ—Å—Ç—É–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
 * –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É (—Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
 * –í –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö MAC-–∞–¥—Ä–µ—Å–æ–≤
 * @return String JSON-–º–∞—Å—Å–∏–≤ —Å MAC-–∞–¥—Ä–µ—Å–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ["AA:BB:CC:DD:EE:FF"]
 */
String getConnectedMACs() {
  String macs = "[";
  // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–π –∫ AP
  uint8_t count = WiFi.softAPgetStationNum();
  
  if (count > 0) {
    // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è 
    // —Ä–µ–∞–ª—å–Ω—ã—Ö MAC-–∞–¥—Ä–µ—Å–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–¥–∏–Ω –∑–∞–≥–ª—É—à–µ—á–Ω—ã–π MAC-–∞–¥—Ä–µ—Å
    macs += "\"1A:2B:3C:4D:5E:6F\"";
  }
  // –ó–∞–∫—Ä—ã–≤–∞–µ–º JSON-–º–∞—Å—Å–∏–≤
  macs += "]";
  return macs;
}

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã "/status"
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ç–µ–∫—É—â–∏–º —Å—Ç–∞—Ç—É—Å–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç send_P() –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ PROGMEM (—ç–∫–æ–Ω–æ–º–∏—è RAM)
 */
void handleStatus() {
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º HTTP-–æ—Ç–≤–µ—Ç 200 OK —Å —Ç–∏–ø–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞ text/html
  // STATUS_PAGE - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –∏–∑ web_pages.h, —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–æ —Ñ–ª–µ—à-–ø–∞–º—è—Ç–∏
  server.send_P(200, "text/html", STATUS_PAGE);
}

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ "/attributes"
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
 */
void handleAttributes() {
  server.send_P(200, "text/html", ATTRIBUTES_PAGE);
}

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞—Ç—á–∏–∫–æ–≤ "/sensors"
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞–º–∏
 */
void handleSensors() {
  server.send_P(200, "text/html", SENSORS_PAGE);
}

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ "/settings"
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
 */
void handleSettings() {
  server.send_P(200, "text/html", SETTINGS_PAGE);
}

/**
 * API-—ç–Ω–¥–ø–æ–∏–Ω—Ç "/api/status" - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, —Ç–∞–∫ –∏ –º–æ–±–∏–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
 */
void handleApiStatus() {
  // –ù–∞—á–∏–Ω–∞–µ–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ JSON-–æ–±—ä–µ–∫—Ç–∞
  String json = "{";
  
  // === –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ===
  json += "\"freeHeap\":" + String(ESP.getFreeHeap()) + ",";        // –°–≤–æ–±–æ–¥–Ω–∞—è RAM –≤ –±–∞–π—Ç–∞—Ö
  json += "\"totalHeap\":" + String(80192) + ",";                  // –û–±—â–∞—è RAM (80KB = 80192 –±–∞–π—Ç)
  json += "\"fsUsed\":125,";                                       // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ FS (–∑–∞–≥–ª—É—à–∫–∞)
  json += "\"fsTotal\":3072,";                                     // –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä FS (3MB = 3072 KB)
  json += "\"uptime\":" + String(millis() / 1000) + ",";           // –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
  json += "\"updateInterval\":5,";                                 // –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–∑–∞–≥–ª—É—à–∫–∞)
  
  // === Wi-Fi —Å—Ç–∞—Ç—É—Å ===
  json += "\"wifiMode\":\"STA\",";                                 // –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (STA = Station)
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Wi-Fi
  json += "\"wifiConnected\":" + String(WiFi.status() == WL_CONNECTED ? "true" : "false") + ",";
  json += "\"ssid\":\"" + String(WiFi.SSID()) + "\",";             // –ò–º—è –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–π —Å–µ—Ç–∏
  json += "\"ipAddress\":\"" + WiFi.localIP().toString() + "\",";   // IP-–∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  
  // === –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–∫ AP) ===
  json += "\"connectedClients\":" + String(WiFi.softAPgetStationNum()) + ","; // –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  json += "\"maxClients\":1,";                                    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–∑–∞–≥–ª—É—à–∫–∞)
  json += "\"macAddresses\":" + getConnectedMACs() + ",";          // –°–ø–∏—Å–æ–∫ MAC-–∞–¥—Ä–µ—Å–æ–≤
  
  // === –î–∞–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–æ–≤ ===
  json += "\"sensors\":" + getSensorDataJSON();                    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–æ–≤
  
  // –ó–∞–∫—Ä—ã–≤–∞–µ–º JSON-–æ–±—ä–µ–∫—Ç
  json += "}";
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º JSON-–æ—Ç–≤–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º Content-Type
  server.send(200, "application/json", json);
}

/**
 * API-—ç–Ω–¥–ø–æ–∏–Ω—Ç "/api/sensors/list" - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –¥–∞—Ç—á–∏–∫–æ–≤
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤—Å–µ—Ö –¥–∞—Ç—á–∏–∫–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ
 */
void handleApiSensorsList() {
  // –§–æ—Ä–º–∏—Ä—É–µ–º JSON-–º–∞—Å—Å–∏–≤ —Å —Ç—Ä–µ–º—è —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞—Ç—á–∏–∫–∞–º–∏
  String json = "{\"sensors\":[";
  
  // –î–∞—Ç—á–∏–∫ 1: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
  json += "{\"id\":1,\"name\":\"–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞\",\"type\":\"DHT22\",\"unit\":\"¬∞C\",";
  json += "\"minVal\":-10,\"maxVal\":50,\"pin\":2,\"enabled\":true},";
  
  // –î–∞—Ç—á–∏–∫ 2: –í–ª–∞–∂–Ω–æ—Å—Ç—å  
  json += "{\"id\":2,\"name\":\"–í–ª–∞–∂–Ω–æ—Å—Ç—å\",\"type\":\"DHT22\",\"unit\":\"%\",";
  json += "\"minVal\":0,\"maxVal\":100,\"pin\":2,\"enabled\":true},";
  
  // –î–∞—Ç—á–∏–∫ 3: –î–∞–≤–ª–µ–Ω–∏–µ (–æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  json += "{\"id\":3,\"name\":\"–î–∞–≤–ª–µ–Ω–∏–µ\",\"type\":\"BME280\",\"unit\":\"–º–º —Ä—Ç.—Å—Ç.\",";
  json += "\"minVal\":700,\"maxVal\":800,\"pin\":4,\"enabled\":false}";
  
  json += "]}";
  
  server.send(200, "application/json", json);
}

/**
 * API-—ç–Ω–¥–ø–æ–∏–Ω—Ç "/api/settings" - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ –º–µ—Ç–æ–¥–∞:
 * - GET: –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
 * - POST: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
 */
void handleApiSettings() {
  if (server.method() == HTTP_GET) {
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
    String json = "{\"ssid\":\"Home_WiFi\",\"password\":\"******\",\"updateInterval\":5,\"maxClients\":1}";
    server.send(200, "application/json", json);
  } 
  else if (server.method() == HTTP_POST) {
    // –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ LittleFS
    // –°–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—Ö
    server.send(200, "application/json", "{\"status\":\"success\"}");
  }
}

/**
 * API-—ç–Ω–¥–ø–æ–∏–Ω—Ç "/api/sensors/toggle/:id" - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞
 * –ú–µ—Ç–æ–¥ POST, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ID –¥–∞—Ç—á–∏–∫–∞ –∏–∑ URL –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä enabled –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
 * –í–∫–ª—é—á–∞–µ—Ç –∏–ª–∏ –≤—ã–∫–ª—é—á–∞–µ—Ç –¥–∞—Ç—á–∏–∫ –±–µ–∑ –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã
 */
void handleApiSensorsToggle() {
  // –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞
  // –°–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—Ö
  server.send(200, "application/json", "{\"status\":\"success\"}");
}

/**
 * API-—ç–Ω–¥–ø–æ–∏–Ω—Ç "/api/sensors/delete/:id" - —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞
 * –ú–µ—Ç–æ–¥ DELETE, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ID –¥–∞—Ç—á–∏–∫–∞ –∏–∑ URL
 * –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –¥–∞—Ç—á–∏–∫ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
 */
void handleApiSensorsDelete() {
  // –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞
  // –°–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—Ö  
  server.send(200, "application/json", "{\"status\":\"success\"}");
}

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
 * –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã (routes) –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä
 */
void initWebServer() {
  // === –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è HTML-—Å—Ç—Ä–∞–Ω–∏—Ü ===
  server.on("/", handleStatus);                    // –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  server.on("/attributes", handleAttributes);      // –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫  
  server.on("/sensors", handleSensors);            // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∞—Ç—á–∏–∫–æ–≤
  server.on("/settings", handleSettings);          // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
  
  // === –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API-—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ ===
  server.on("/api/status", handleApiStatus);                    // –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
  server.on("/api/sensors/list", handleApiSensorsList);         // –°–ø–∏—Å–æ–∫ –¥–∞—Ç—á–∏–∫–æ–≤
  server.on("/api/settings", handleApiSettings);                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
  server.on("/api/sensors/toggle/:id", HTTP_POST, handleApiSensorsToggle); // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞
  server.on("/api/sensors/delete/:id", HTTP_DELETE, handleApiSensorsDelete); // –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
  server.begin();
  Serial.println("üåê –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω");
}

/**
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –≤–µ–±-–∑–∞–ø—Ä–æ—Å–æ–≤
 * –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤ loop()
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö
 */
void handleWebRequests() {
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
  server.handleClient();
}